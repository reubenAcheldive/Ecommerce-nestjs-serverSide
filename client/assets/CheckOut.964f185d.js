import{b as r,j as e,U as A,I as $,i as j,k as H,u as g,r as u,d as S,o as B,l as D,c as M,m as E,F as R,n as _,p as z,T as W,O as V,q as Y,t as q}from"./index.2406d438.js";import{c as G,S as J,C as K,a as Q}from"./SplitScreen.281d629a.js";import{A as X,B as Z}from"./AddProducts.c8d0bf2a.js";import{T as d,L as O,a as L,B as ee,P as v}from"./PopModal.aee7592a.js";import"./WrapperIcon.89800183.js";const te=({data:a,setOpenItemModal:c,countItems:s,setOpenUserForm:n,cart:t})=>{const l="w-64 h-12 text-center flex items-center gap-8 cursor-pointer hover:bg-purple-400";return r("div",{className:"bg-purple-200 w-full h-80 flex flex-col items-center gap-2 p-4",children:[e("div",{className:l,onClick:()=>n(!0),children:e(A,{})}),r("div",{onClick:()=>c(!0),className:l,children:[e($,{className:"",content:"items",children:e("span",{className:"text-2xl",children:String(s)||""})})," "]}),e("div",{className:`${l} `,children:e(j,{})}),e("div",{className:`${l} `,children:e(H,{})}),r("div",{className:`${l} text-xl`,children:["For payment ",G((t==null?void 0:t.items)||[]),"$"]})]})},se=()=>{const{lastOrderID:a}=g(l=>l.order),[c,s]=u.exports.useState(!1),n=S();return{downLoadInvoice:async()=>{if(a!=null&&a.length)return await B.order.get(a).then(l=>{const i=URL.createObjectURL(l.data),o=document.createElement("a");o.href=i,o.setAttribute("download","file.pdf"),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(i),s(!1),n("/dashboard")}).catch(()=>{s(!1),n("/dashboard")}).finally(()=>{s(!1),n("/dashboard")})},openModalInvoice:c,setOpenModalInvoice:s}},ae=({cart:a})=>{const{items:c}=a;return e("div",{className:"flex justify-center items-center",children:r(d,{children:[r(d.Head,{children:[e(d.HeadCell,{}),e(d.HeadCell,{children:"Product name"}),e(d.HeadCell,{children:"Amount"}),e(d.HeadCell,{children:"Price"}),e(d.HeadCell,{children:e("span",{className:"sr-only",children:"Edit"})})]}),e(d.Body,{className:"divide-y",children:c==null?void 0:c.map(({_id:s,productRefId:{name:n,price:t,imgUrl:l,_id:i},quantity:o})=>r(d.Row,{className:"bg-white dark:border-gray-700 dark:bg-gray-800",children:[e(d.Cell,{className:"whitespace-nowrap font-medium text-gray-900 dark:text-white",children:e("img",{className:"w-10 h-10",src:l})}),e(d.Cell,{children:n}),r(d.Cell,{children:[e(X,{quantity:o,productRefId:i,size:"big",className:"flex content-between gap-4 text-lg text-white"})," "]}),e(d.Cell,{children:(o*t).toFixed(2)})]},i))})]})})},ne=({firstName:a,lastName:c,userId:s,setOpenUserForm:n})=>{const{register:t,handleSubmit:l,formState:{errors:i},getValues:o}=D({defaultValues:{firstName:a,lastName:c,userId:s}}),h=M(),{data:p,loading:f}=g(m=>m.auth);return u.exports.useEffect(()=>{console.log(1),n(m=>!m)},[p]),r("form",{className:"m-8 w-96 h-52 flex flex-col  justify-center gap-8",onSubmit:l(m=>{!m||h(E({...m}))}),children:[r("div",{children:[e("div",{className:"mb-2 block",children:e(O,{htmlFor:"small",value:"First Name"})}),e(L,{...t("firstName"),id:"small",type:"text",sizing:"sm"})]}),r("div",{children:[e("div",{className:"mb-2 block",children:e(O,{htmlFor:"small",value:"Last Name"})}),e(L,{...t("lastName"),id:"small",type:"text",sizing:"sm"})]}),e(ee,{className:" ",type:"submit",color:"purple",children:f?"loading....":" submit"})]})},le=({onClick:a})=>r("div",{className:"w-80 h-56 flex flex-col items-center gap-8",children:[e("h4",{className:"from-neutral-600 text-2xl text-black",children:"Download Your Invoice"}),e("button",{className:"p-4 bg-violet-600 rounded-md text-xl text-white",onClick:a,children:"Download"}),r("div",{className:"flex flex-col gap-2",children:[e("p",{children:"Thank you for purchasing from us.  "}),e("strong",{className:"text-center",children:"We'd love to see you again"})]})]}),re=({openItemModal:a,openUserForm:c,setOpenItemModal:s,setOpenUserForm:n,openModalInvoice:t,setOpenModalInvoice:l,downLoadInvoice:i})=>{const{auth:o,cart:h}=g(p=>p);return r(R,{children:[h.cart&&e(v,{isOpen:a,setIsOpen:s,children:e(ae,{cart:h.cart})}),o.data&&e(v,{isOpen:c,setIsOpen:n,children:e(ne,{...o.data,setOpenUserForm:n})}),e(v,{isOpen:t,setIsOpen:l,children:e(le,{onClick:i})})]})},ue=()=>{var I;const a=M(),{auth:c,cart:s,order:n}=g(x=>x),{data:t}=c,l=S();u.exports.useEffect(()=>{t!=null&&t.userId&&(a(_(t==null?void 0:t.userId)),a(z(t==null?void 0:t.userId)))},[t==null?void 0:t.userId]);const i=((I=s.cart)==null?void 0:I.items.length)||0,[o,h]=u.exports.useState(!1),[p,f]=u.exports.useState(!1),{showMenu:N,setShowMenu:m,showCart:b,showUserToggle:ce}=u.exports.useContext(W),{downLoadInvoice:F,openModalInvoice:P,setOpenModalInvoice:y}=se(),U=()=>{var x,w,k,C;if((x=n.payment)!=null&&x.length||(l("/order/checkout/payment"),a(Y(!0))),c.data&&s.cart&&s.cart.items.length>0&&n.payment&&((w=n.payment)==null?void 0:w.length)>0){const T={cartRef:(k=s.cart)==null?void 0:k._id,customerRef:c.data.userId,dateDelivery:"",items:(C=s.cart)==null?void 0:C.items,paymentRef:{idPayment:n.payment[0]._id}};a(q(T)),y(!0)}};return r(R,{children:[r(J,{children:[r("div",{className:`${b?"hidden md:block":"block"}`,children:[e(K,{setShowMenu:m,showMenu:N}),e(V,{})]}),r("div",{className:"  md:h-96 flex flex-col gap-8",children:[e("span",{className:"block md:hidden",children:e(Q,{cart:s.cart})}),e("div",{className:`${b?"hidden md:block":"block"}`,children:e(te,{data:t,setOpenItemModal:h,countItems:i,setOpenUserForm:f,cart:s.cart})}),e(Z,{className:`${b?"hidden md:block":"block"} bg-red-600 py-4 px-36 text-xl text-white rounded-lg self-center`,content:"Order",onClick:()=>U()})]})]}),e(re,{downLoadInvoice:F,openItemModal:o,openModalInvoice:P,openUserForm:p,setOpenItemModal:h,setOpenModalInvoice:y,setOpenUserForm:f})]})};export{ue as default};
